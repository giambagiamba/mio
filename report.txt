Dopo aver fatto il multitasking ho rifatto la richiesta della memoria, ex novo. Tutto andava in crash, anche mettendo la vecchia richiesta di memoria, che funzionava perché l'ho usata su diversi calcolatori. Dopo una giornata ho scoperto che la causa del problema era il fatto che int 0x15 di virtualbox lascia i flags in uno stato poco pulito. Per risolvere bastava contornare la richiesta di memoria tra pushf e popf. Il programma elimina le voci di memoria inutilizzabile già durante la fase di richiesta. L'ultima cosa in opera era la creazione della bitmap per una eventuale malloc. Il programma non crasha, mostra il corretto valore di memoria totale, ma non ho idea se la bitmap è giusta. Del resto con la VM è facile perché è una sola regione senza discontinuità.
La costruzione della bitmap è difettosa, dato che crasha con una ram superiore a 125 MB circa. Fino alla stampa della "struttura int 0x15" funziona. Iniziato a fare la malloc ma va pensata bene.

